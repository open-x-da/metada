# TL/AD Checks Configuration File
# This file configures the tangent linear and adjoint checks application

# Logger configuration  
logger:
  app_name: "tl_ad_checks"
  level: "debug"
  color: true
  console: true

# Global parameters
# Tolerance for TL/AD consistency check
# (relative error threshold)
# Note: For nonlinear observation operators, gradient checks typically achieve
#       1-5% relative error due to truncation errors in finite differences
tl_ad_tolerance: 1.0e-2  # 1% tolerance for gradient checks with nonlinear operators
gradient_tolerance: 1.0e-6
# Number of random directions for gradient checks
gradient_check_directions: 10
finite_difference_epsilons:
   - 1.0e-1   # Start larger to see truncation error regime
   - 1.0e-2
   - 1.0e-3
   - 1.0e-4
   - 1.0e-5
   - 1.0e-6
   - 1.0e-7

# Analysis time configuration
analysis_time: &analysis_time "2008-02-05T12:00:00Z"
time_window: &time_window "Â±5m" # Time window around analysis time

# Variational method: 3DVAR (single time analysis)
variational_type: "3DVAR"

# Minimization configuration
minimization_algorithm: lbfgs
max_iterations: 50
tolerance: 1e-6
gradient_tolerance: 1e-6
line_search_enabled: true
preconditioning_enabled: false

# Geometry configuration (WRF domain)
# WRFGeometry automatically reads all grid information from the NetCDF file
geometry:
  file: "D:/linux/metada/build/wrfinput_d01"
  namelist_path: "D:/linux/metada/build/namelist.input"
  domain_id: 1

# Background state configuration
background:
  file: "D:/linux/metada/build/wrfinput_d01"
  # Analysis variables for 3DVAR
  variables:
    - U
    - V
    - T
    - QVAPOR
    - PSFC

# Observation configuration
observation:
  # WRFDA observation file (ASCII format)
  obs_file: "D:/linux/WRF/var/test/tutorial/ob.ascii"
  
  types:
    - adpsfc:
        if_use: true
        file: "D:/linux/metada/applications/obs_processing/prepbufr.gdas.2000012412.wo40.nr"
        coordinate: "geographic"
        data_types: ["ADPSFC"]
        station_ids: [72405]
        analysis_time: *analysis_time
        time_window: *time_window
        variables:
          - U:
              if_use: true
              error: 1.5
          - V:
              if_use: true
              error: 1.5
          - T:
              if_use: true
              error: 1.0
          - Q:
              if_use: true
              error: 0.5e-3
          - PSFC:
              if_use: true
              error: 100.0

# Observation operator configuration
obs_operator:
  type: "WRFDA"
  required_state_vars: [U, V, T, QVAPOR, PSFC, P, PB, PH, PHB, HGT]
  operator_families: ["synop"]  # SYNOP surface observations
  interpolation_method: "bilinear"
  vertical_interpolation: "pressure"
  surface_correction: true
  quality_control: true

# Model configuration (WRF model settings)
model:
  # Time control settings
  time_control:
    start_datetime: "2008-02-05T12:00:00Z"
    forecast_length: "1s"  # Minimal forecast for TL/AD checks
    time_step: "30s"
    output_history: false
    
  # Physics options
  physics:
    microphysics: true
    radiation: true
    pbl: true
    lsm: true
    
  # Dynamical core options
  dynamics:
    advection_scheme: "WENO"
    diffusion: 0.01

# Background error covariance configuration
background_covariance:
  # Framework-expected keys
  background_covariance_type: "diagonal"  # Framework expects this key
  localization_enabled: false
  localization_radius: 0.0